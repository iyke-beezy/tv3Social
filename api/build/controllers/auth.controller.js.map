{"version":3,"sources":["../../src/controllers/auth.controller.js"],"names":["DEBUG","createCookieFromToken","Admin","statusCode","req","res","token","generateVerificationToken","status","json","data","signup","next","passport","authenticate","session","err","info","message","error","ApplicationError","login"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;;;;;AAEA,IAAMA,KAAK,GAAG,uBAAM,KAAN,CAAd;;AAEA,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACC,KAAD,EAAQC,UAAR,EAAoBC,GAApB,EAAyBC,GAAzB,EAAiC;AAC3D,MAAMC,KAAK,GAAGJ,KAAK,CAACK,yBAAN,EAAd;AAEAF,EAAAA,GAAG,CAACG,MAAJ,CAAWL,UAAX,EAAuBM,IAAvB,CAA4B;AACxBD,IAAAA,MAAM,EAAE,SADgB;AAExBF,IAAAA,KAAK,EAALA,KAFwB;AAGxBI,IAAAA,IAAI,EAAE;AACFR,MAAAA,KAAK,EAALA;AADE;AAHkB,GAA5B;AAOH,CAVD;;eAYe;AACXS,EAAAA,MAAM;AAAA,0EAAE,kBAAOP,GAAP,EAAYC,GAAZ,EAAiBO,IAAjB;AAAA;AAAA;AAAA;AAAA;AACJC,mCAASC,YAAT,CACI,QADJ,EAEI;AAAEC,gBAAAA,OAAO,EAAE;AAAX,eAFJ;AAAA,mFAGI,iBAAOC,GAAP,EAAYd,KAAZ,EAAmBe,IAAnB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,gCAEYD,GAAG,IAAI,CAACd,KAFpB;AAAA;AAAA;AAAA;;AAAA,6CAGkDe,IAHlD,CAGoBd,UAHpB,EAGoBA,UAHpB,iCAGiC,GAHjC,qBAGsCe,OAHtC,GAGkDD,IAHlD,CAGsCC,OAHtC;AAAA,2DAKmBb,GAAG,CAACG,MAAJ,CAAWL,UAAX,EAAuBM,IAAvB,CAA4B;AAC/BD,4BAAAA,MAAM,EAAE,OADuB;AAE/BW,4BAAAA,KAAK,EAAE;AACHD,8BAAAA,OAAO,EAAPA;AADG;AAFwB,2BAA5B,CALnB;;AAAA;AAYQjB,0BAAAA,qBAAqB,CAACC,KAAD,EAAQ,GAAR,EAAaE,GAAb,EAAkBC,GAAlB,CAArB;AAZR;AAAA;;AAAA;AAAA;AAAA;AAcQL,0BAAAA,KAAK,aAAL;AAdR,gCAec,IAAIoB,wBAAJ,CAAqB,GAArB,cAfd;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAHJ;;AAAA;AAAA;AAAA;AAAA,mBAqBEhB,GArBF,EAqBOC,GArBP,EAqBYO,IArBZ;;AADI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA,KADK;AA0BXS,EAAAA,KAAK,EAAE,eAACjB,GAAD,EAAMC,GAAN,EAAWO,IAAX,EAAoB;AACvBC,yBAASC,YAAT,CAAsB,OAAtB,EAA+B;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAA/B,EAAmD,UAACC,GAAD,EAAMd,KAAN,EAAae,IAAb,EAAsB;AACrE,UAAID,GAAG,IAAI,CAACd,KAAZ,EAAmB;AACf,YAAIgB,OAAO,GAAGF,GAAd;;AACA,YAAIC,IAAJ,EAAU;AACNC,UAAAA,OAAO,GAAGD,IAAI,CAACC,OAAf;AACH;;AACD,eAAOb,GAAG,CAACG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACxBD,UAAAA,MAAM,EAAE,OADgB;AAExBW,UAAAA,KAAK,EAAE;AACHD,YAAAA,OAAO,EAAPA;AADG;AAFiB,SAArB,CAAP;AAMH;;AACDjB,MAAAA,qBAAqB,CAACC,KAAD,EAAQ,GAAR,EAAaE,GAAb,EAAkBC,GAAlB,CAArB;AACH,KAdD,EAcGD,GAdH,EAcQC,GAdR,EAcaO,IAdb;AAeH;AA1CU,C","sourcesContent":["import passport from \"passport\";\r\nimport debug from \"debug\";\r\nimport passportLocal from \"../passport/passport-local\";\r\nimport { ApplicationError, NotFoundError } from \"../helpers/errors\";\r\n\r\nconst DEBUG = debug(\"dev\");\r\n\r\nconst createCookieFromToken = (Admin, statusCode, req, res) => {\r\n    const token = Admin.generateVerificationToken();\r\n\r\n    res.status(statusCode).json({\r\n        status: \"success\",\r\n        token,\r\n        data: {\r\n            Admin,\r\n        },\r\n    });\r\n};\r\n\r\nexport default {\r\n    signup: async (req, res, next) => {\r\n        passport.authenticate(\r\n            \"signup\",\r\n            { session: false },\r\n            async (err, Admin, info) => {\r\n                try {\r\n                    if (err || !Admin) {\r\n                        const { statusCode = 400, message } = info;\r\n\r\n                        return res.status(statusCode).json({\r\n                            status: \"error\",\r\n                            error: {\r\n                                message,\r\n                            },\r\n                        });\r\n                    }\r\n                    createCookieFromToken(Admin, 201, req, res);\r\n                } catch (error) {\r\n                    DEBUG(error);\r\n                    throw new ApplicationError(500, error);\r\n                }\r\n            }\r\n        )(req, res, next);\r\n    },\r\n\r\n    login: (req, res, next) => {\r\n        passport.authenticate(\"login\", { session: false }, (err, Admin, info) => {\r\n            if (err || !Admin) {\r\n                let message = err;\r\n                if (info) {\r\n                    message = info.message;\r\n                }\r\n                return res.status(401).json({\r\n                    status: \"error\",\r\n                    error: {\r\n                        message,\r\n                    },\r\n                });\r\n            }\r\n            createCookieFromToken(Admin, 200, req, res);\r\n        })(req, res, next);\r\n    },\r\n\r\n};"],"file":"auth.controller.js"}