{"version":3,"sources":["../../src/passport/config.js"],"names":["jwtPublicSecret","process","env","JWT_PUBLIC_SECRET","replace","options","secretOrKey","algorithms","passReqToCallback","ignoreExpiration","jwtFromRequest","ExtractJwt","fromAuthHeaderAsBearerToken","passport","use","Strategy","req","jwtPayload","done","Admin","findOne","_id","id","then","admin","_doc","password","err"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEA;AAEA,IAAMA,eAAe,GAAGC,OAAO,CAACC,GAAR,CAAYC,iBAAZ,CAA8BC,OAA9B,CAAsC,MAAtC,EAA8C,IAA9C,CAAxB;AAGA,IAAMC,OAAO,GAAG;AACZC,EAAAA,WAAW,EAAEN,eADD;AAEZO,EAAAA,UAAU,EAAE,CAAC,OAAD,CAFA;AAGZC,EAAAA,iBAAiB,EAAE,IAHP;AAIZC,EAAAA,gBAAgB,EAAE;AAJN,CAAhB;AAOAJ,OAAO,CAACK,cAAR,GAAyBC,wBAAWC,2BAAX,EAAzB;;AAEAC,qBAASC,GAAT,CACI,IAAIC,qBAAJ,CAAaV,OAAb,EAAsB,UAACW,GAAD,EAAMC,UAAN,EAAkBC,IAAlB,EAA2B;AAC7CC,oBAAMC,OAAN,CAAc;AAAEC,IAAAA,GAAG,EAAEJ,UAAU,CAACK;AAAlB,GAAd,EACKC,IADL,CACU,UAAAC,KAAK,EAAI;AACX,QAAIA,KAAJ,EAAW;AACP,aAAOA,KAAK,CAACC,IAAN,CAAWC,QAAlB;AACAR,MAAAA,IAAI,CAAC,IAAD,EAAOM,KAAP,CAAJ;AACH,KAHD,MAGO;AACHN,MAAAA,IAAI,CAAC,IAAD,EAAO,KAAP,CAAJ;AACH;AACJ,GARL,WASW,UAAAS,GAAG,EAAI;AACV,QAAIA,GAAJ,EAAS;AACL,aAAOT,IAAI,CAACS,GAAD,EAAM,KAAN,CAAX;AACH;AACJ,GAbL;AAcH,CAfD,CADJ;;eAmBed,oB","sourcesContent":["import passport from 'passport';\r\nimport { ExtractJwt, Strategy } from 'passport-jwt';\r\nimport { config } from 'dotenv';\r\nimport Admin from '../models/admin.model';\r\n\r\nconfig()\r\n\r\nconst jwtPublicSecret = process.env.JWT_PUBLIC_SECRET.replace(/\\\\n/g, '\\n');\r\n\r\n\r\nconst options = {\r\n    secretOrKey: jwtPublicSecret,\r\n    algorithms: ['RS256'],\r\n    passReqToCallback: true,\r\n    ignoreExpiration: true\r\n};\r\n\r\noptions.jwtFromRequest = ExtractJwt.fromAuthHeaderAsBearerToken()\r\n\r\npassport.use(\r\n    new Strategy(options, (req, jwtPayload, done) => {\r\n        Admin.findOne({ _id: jwtPayload.id })\r\n            .then(admin => {\r\n                if (admin) {\r\n                    delete admin._doc.password;\r\n                    done(null, admin);\r\n                } else {\r\n                    done(null, false);\r\n                }\r\n            })\r\n            .catch(err => {\r\n                if (err) {\r\n                    return done(err, false);\r\n                }\r\n            });\r\n    }),\r\n);\r\n\r\nexport default passport;"],"file":"config.js"}